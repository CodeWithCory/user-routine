var __awaiter=this&&this.__awaiter||function(t,e,i,s){return new(i||(i=Promise))((function(o,n){function r(t){try{l(s.next(t))}catch(t){n(t)}}function c(t){try{l(s.throw(t))}catch(t){n(t)}}function l(t){var e;t.done?o(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(r,c)}l((s=s.apply(t,e||[])).next())}))};export class SpaCheck{constructor(t,e){this.updateList=[],this.startTime=new Date,this.continue=!0,this.errorOccurred=!1,this.config=Object.assign(Object.assign({},SpaCheck.defaultConfig),e),this.start(t)}start(t){return __awaiter(this,void 0,void 0,(function*(){try{this.messageStart();for(const e of t)!this.config.continueOnFailure&&this.continue&&(yield this.sleep(this.config.globalDelay),yield this.do(e));this.messageEnd();const e=!this.errorOccurred;this.config.done(e,this.updateList)}catch(t){this.error("Unepected error received",t,!1)}}))}do(t){return __awaiter(this,void 0,void 0,(function*(){if("string"==typeof t)this.doActionString(t);else if("function"==typeof t)try{t()}catch(e){this.error("Error running provided function",e+"; function: "+t.toString())}else this.error("Action is not of type string or function, got",typeof t)}))}doActionString(t){const e=t.substring(0,3);if("nav"===e){const e=t.split(" ")[1];e&&"#"===e[0]?(window.location.href=e,this.log(`Navigated to ${e}`)):this.error("Unexpected nav action, got",t)}else if("cli"===e){const e=t.split(" ")[1];this.select(e).click(),this.log(`Clicked on ${e}`)}else if("exi"===e){const e=t.split(" ")[1];this.select(e),this.log(`Verified ${e} exists`)}else if("val"===e){const[e,i,s]=this.argSplit(t);this.select(i).value=s,this.log(`Set the value of ${i} to ${s}`)}else if("inc"===e){const[e,i,s]=this.argSplit(t);-1===this.select(i).innerText.indexOf(s)?this.error("Text not found",s):this.log(`Verified ${i} includes "${s}"`)}else if("wri"===e){const[e,i,s]=this.argSplit(t);this.select(i).textContent+=s,this.log(`Wrote "${s}" at the end of ${i}`)}else if("log"===e){const[e,i]=t.split(/ (.*)/s);console.log(i)}else""===t||this.error("Action string keyword not recognized, got",t)}select(t){const e=document.querySelector(t);return e||(this.continue=!1,this.error("CSS Selector not found",t)),e}argSplit(t){const e=t.split(/ ([^\s]+) (.*)/s);return e.length<3&&this.error(`Unexpected ${e[0]} input, got:`,t),e}messageStart(){console.group(`[SpaCheck] ${this.config.message}`),this.msgElement=this.config.messageShowInDOM&&this.config.message?this.displayMessageInDOM(this.config.message,this.config.messageStyle):void 0}messageEnd(){this.msgElement&&this.msgElement.remove(),console.groupEnd()}displayMessageInDOM(t,e){var i;const s=document.createElement("p");return s.textContent=t,s.setAttribute("style",e),null===(i=document.querySelector("body"))||void 0===i||i.appendChild(s),s}log(t){const e=`* ${t}`;this.updateList.push(e),this.config.logUpdates&&console.log(e)}error(t,e,i=this.config.continueOnFailure){const s=`* ${t}: '${e}'`;if(this.updateList.push(s),!i)throw this.config.done(!1,this.updateList),new Error(`${s}. Halting execution.`);console.error(`${s}. Continuing execution.`)}sleep(t){return new Promise((e=>setTimeout(e,t)))}}SpaCheck.defaultConfig={continueOnFailure:!1,done:(t,e)=>{console.log("Success:",t)},globalDelay:500,logUpdates:!0,message:"",messageShowInDOM:!1,messageStyle:"font-size:24px; padding:10px; z-index:9999; position:fixed; top:0; right:10%; color:black; background-color:rgba(222,222,222,0.8);"};
