var __awaiter=this&&this.__awaiter||function(t,e,i,o){return new(i||(i=Promise))((function(s,n){function r(t){try{a(o.next(t))}catch(t){n(t)}}function l(t){try{a(o.throw(t))}catch(t){n(t)}}function a(t){var e;t.done?s(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(r,l)}a((o=o.apply(t,e||[])).next())}))};export function spaCheck(t,e={}){return __awaiter(this,void 0,void 0,(function*(){const i=[],o=Object.freeze(Object.assign(Object.assign({},{continueOnFailure:!1,globalDelay:500,awaitTimeout:15e3,logCollapse:!1,logResult:!0,logUpdates:!0,message:"",messageShowInDOM:!1,messageStyle:"font-size:24px; padding:10px; z-index:9999; position:fixed; top:0; right:10%; color:black; background-color:rgba(222,222,222,0.8);"}),e)),s=o.message?`[SPA Check] ${o.message}`:"[SPA Check]";let n,r=!1,l=!0;return this.main=t=>__awaiter(this,void 0,void 0,(function*(){yield this.messageStart();if(!this.validateInputs(t,e))return this.finish();for(const e of t){if(!l)return this.finish();yield this.sleep(o.globalDelay);try{yield this.do(e)}catch(t){this.error("Unexpected error: "+t.message)}}return this.finish()})),this.finish=()=>{const t=!r,e={success:t,log:i,message:o.message};return this.log(`Done, success: ${t}`),this.messageEnd(e),e},this.do=t=>__awaiter(this,void 0,void 0,(function*(){if("string"==typeof t)yield this.doActionString(t);else if("function"==typeof t)try{yield t(),this.log("Ran provided function")}catch(e){this.error("Error running provided function",e+"; function: "+t.toString())}else this.error("Action is not of type string or function, got",typeof t)})),this.doActionString=t=>__awaiter(this,void 0,void 0,(function*(){const e=t.substring(0,3);if("nav"===e){const e=t.split(" ")[1];e&&"#"===e[0]?(window.location.href=e,this.log(`Navigated to ${e}`)):this.error("Unexpected nav action, got",t)}else if("cli"===e){const[e,i,o]=this.argSplitComplex(t),s=this.getTargetText(i,o);if(o){const t=document.querySelectorAll(i);let e=!1;for(const i of t)if(i&&i.textContent&&i.textContent.toLowerCase().includes(o.toLowerCase())){e=!0,i.click();break}e?this.log(`Clicked ${s}`):this.error("Could not find selector to click",s)}else{const t=this.select(i);if(!t)return;t.click(),this.log(`Clicked ${s}`)}}else if("exi"===e){const[e,i,o]=this.argSplitComplex(t),s=this.getTargetText(i,o);let n=!1;if(o){const t=document.querySelectorAll(i);for(const e of t)if(e&&e.textContent&&e.textContent.toLowerCase().includes(o.toLowerCase())){n=!0;break}}else{document.querySelector(i)&&(n=!0)}n?this.log(`Did exist: ${s}`):this.error("Did not exist",s)}else if("val"===e){const[e,i,o]=this.argSplit(t);if(!this.select(i))return;this.select(i).value=o,this.log(`Set the value of ${i} to ${o}`)}else if("wri"===e||"app"===e){const[i,o,s]=this.argSplit(t),n=this.select(o);if(!n)return;"wri"===e?(n.textContent=s,this.log(`Wrote '${s}' over ${o}`)):(n.textContent+=s,this.log(`Appended '${s}' to ${o}`))}else if("log"===e){const[e,i]=t.split(/ (.*)/s);this.log(i)}else if("wai"===e){const[e,i]=t.split(" ");this.log(`Waiting ${Number(i)/1e3} second(s)`),yield this.sleep(Number(i))}else if("awa"===e){const[e,i,s]=this.argSplitComplex(t),n=o.awaitTimeout/o.globalDelay;let r=!1;const l=this.getTargetText(i,s);this.log(`Awaiting ${l}...`);for(let t=0;t<n;t++){if(s){const t=Array.from(document.querySelectorAll(i));for(const e of t)if(e&&e.textContent&&e.textContent.toLowerCase().includes(s.toLowerCase())){r=!0;break}}else{document.querySelector(i)&&(r=!0)}if(r)break;yield this.sleep(o.globalDelay)}r?this.log(`...Found ${l}`):this.error(`Timed out after ${o.awaitTimeout/1e3} second(s) awaiting`,l)}else""===t||this.error("Action string keyword not recognized, got",t)})),this.select=t=>{const e=document.querySelector(t);return e||this.error("CSS Selector not found",t),e},this.getTargetText=(t,e)=>`'${t}'`+(e?` containing text '${e}'`:""),this.argSplit=t=>{const e=t.split(/ ([^\s]+) (.*)/s);return e.length<3&&this.error(`Unexpected ${e[0]} input with data, got:`,t),e},this.argSplitComplex=t=>{const e=t.split(" ");return e.length>2?this.argSplit(t):e},this.messageStart=()=>__awaiter(this,void 0,void 0,(function*(){yield this.sleep(0),o.logUpdates&&(o.logCollapse?console.groupCollapsed(s):console.group(s)),n=o.messageShowInDOM&&o.message?this.displayMessageInDOM(o.message,o.messageStyle):void 0})),this.messageEnd=t=>{n&&n.remove();const e=o.logUpdates?"":s;o.logResult&&console.log(`${e} Result:`,t),o.logUpdates&&console.groupEnd()},this.displayMessageInDOM=(t,e)=>{var i;const o=document.createElement("p");return o.textContent=t,o.setAttribute("style",e),null===(i=document.querySelector("body"))||void 0===i||i.appendChild(o),o},this.validateInputs=(t,e)=>{let i=!0;return void 0===t?(i=!1,this.error("Missing required argument Action List","",!1)):Array.isArray(t)||(i=!1,this.error("Action list argument is not an Array","",!1)),void 0===e||"object"==typeof e&&!Array.isArray(e)||(i=!1,this.error("Options argument is not an Object","",!1)),i},this.log=t=>{i.push(t);const e=`* ${t}`;o.logUpdates&&console.log(e)},this.error=(t,e,s=o.continueOnFailure)=>{r=!0;let n=`FAIL: ${t}`+(e?`: '${e}'`:"");s?n+=". Continuing execution.":(l=!1,n+=". Halting execution."),i.push(n),console.error(n)},this.sleep=t=>new Promise((e=>setTimeout(e,t))),yield this.main(t)}))}
