var __awaiter=this&&this.__awaiter||function(t,e,i,o){return new(i||(i=Promise))((function(s,n){function r(t){try{a(o.next(t))}catch(t){n(t)}}function l(t){try{a(o.throw(t))}catch(t){n(t)}}function a(t){var e;t.done?s(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(r,l)}a((o=o.apply(t,e||[])).next())}))};function spaCheck(t,e){return __awaiter(this,void 0,void 0,(function*(){const i=[],o=Object.assign(Object.assign({},{continueOnFailure:!1,globalDelay:500,awaitTimeout:15e3,logUpdates:!0,message:"",messageShowInDOM:!1,messageStyle:"font-size:24px; padding:10px; z-index:9999; position:fixed; top:0; right:10%; color:black; background-color:rgba(222,222,222,0.8);"}),e);let s,n=!1,r=!0;return this.main=t=>__awaiter(this,void 0,void 0,(function*(){this.messageStart();for(const e of t){if(!r)return this.finish();yield this.sleep(o.globalDelay);try{yield this.do(e)}catch(t){console.error("FAIL: Unexpected error received",t)}}return this.finish()})),this.finish=()=>{const t=!n,e={success:t,log:i,message:o.message};return this.log(`Done, success: ${t}`),this.messageEnd(e),e},this.do=t=>__awaiter(this,void 0,void 0,(function*(){if("string"==typeof t)yield this.doActionString(t);else if("function"==typeof t)try{yield t(),this.log("Ran provided function")}catch(e){this.error("Error running provided function",e+"; function: "+t.toString())}else this.error("Action is not of type string or function, got",typeof t)})),this.doActionString=t=>__awaiter(this,void 0,void 0,(function*(){var e;const i=t.substring(0,3);if("nav"===i){const e=t.split(" ")[1];e&&"#"===e[0]?(window.location.href=e,this.log(`Navigated to ${e}`)):this.error("Unexpected nav action, got",t)}else if("cli"===i){const e=t.split(" ")[1],i=this.select(e);if(!i)return;i.click(),this.log(`Clicked ${e}`)}else if("exi"===i){const i=t.split(" "),[o,s,n]=i.length>2?this.argSplit(t):i,r=document.querySelector(s),l=n?r&&(null===(e=r.textContent)||void 0===e?void 0:e.toLowerCase().includes(n.toLowerCase())):r,a=`'${s}'`+(n?` containing text '${n}'`:"");l?this.log(`Exists: ${a}`):this.error("Does not exist",a)}else if("val"===i){const[e,i,o]=this.argSplit(t);if(!this.select(i))return;this.select(i).value=o,this.log(`Set the value of ${i} to ${o}`)}else if("wri"===i||"app"===i){const[e,o,s]=this.argSplit(t),n=this.select(o);if(!n)return;"wri"===i?(n.textContent=s,this.log(`Wrote '${s}' over ${o}`)):(n.textContent+=s,this.log(`Appended '${s}' to ${o}`))}else if("log"===i){const[e,i]=t.split(/ (.*)/s);this.log(i)}else if("wai"===i){const[e,i]=t.split(" ");this.log(`Waiting ${Number(i)/1e3} second(s)`),yield this.sleep(Number(i))}else if("awa"===i){const e=t.split(" "),[i,s,n]=e.length>2?this.argSplit(t):e,r=o.awaitTimeout/o.globalDelay;let l,a;const c=`'${s}'`+(n?` containing text '${n}'`:"");this.log(`Awaiting ${c}...`);for(let t=0;t<r&&(l=document.querySelector(s),a=n?l&&l.textContent.toLowerCase().includes(n.toLowerCase()):l,!a);t++)yield this.sleep(o.globalDelay);a?this.log(`... Found ${c}`):this.error(`Timed out after ${o.awaitTimeout/1e3} second(s) awaiting`,c)}else""===t||this.error("Action string keyword not recognized, got",t)})),this.select=t=>{const e=document.querySelector(t);return e||this.error("CSS Selector not found",t),e},this.argSplit=t=>{const e=t.split(/ ([^\s]+) (.*)/s);return e.length<3&&this.error(`Unexpected ${e[0]} input with data, got:`,t),e},this.messageStart=()=>{o.logUpdates&&console.group(`[SPA Check] ${o.message}`),s=o.messageShowInDOM&&o.message?this.displayMessageInDOM(o.message,o.messageStyle):void 0},this.messageEnd=t=>{s&&s.remove(),o.logUpdates&&console.log("Result:",t),o.logUpdates&&console.groupEnd()},this.displayMessageInDOM=(t,e)=>{var i;const o=document.createElement("p");return o.textContent=t,o.setAttribute("style",e),null===(i=document.querySelector("body"))||void 0===i||i.appendChild(o),o},this.log=t=>{i.push(t);const e=`* ${t}`;o.logUpdates&&console.log(e)},this.error=(t,e,s=o.continueOnFailure)=>{n=!0;let l=`FAIL: ${t}: '${e}'`;if(!s)throw r=!1,l+=". Halting execution.",i.push(l),new Error(l);l+=". Continuing execution.",i.push(l),console.error(l)},this.sleep=t=>new Promise((e=>setTimeout(e,t))),yield this.main(t)}))}
